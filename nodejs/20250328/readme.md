

# OAuth 2.0 카카오 로그인  

> 어플리케이션 간의 인증을 허가를 위해서 사용하는 프로토콜
> 사용자의 신상을 노출하지않고 다른 제 3 자의 인증을 받아서
> 사용자의 정보를 돈늬를 받고 정보를 기반으로 권한을 인증할수 있게 한다

## OAuth 는 
> 인증과 허가를 제공하는 프로토클
> 목적은 사용자가 자신의 아이디와 비밀번호를 외부에 노출하지 않고
> 외부의 서비스에 본인의 아이디나 비밀번호를 제공하지않고 제34자를 통해거 다른 서비스를 사용할수 있는기능을 제공
> 사용자가 플랫품의 로그인 없이 제3자 즉 카카오 구글 네이버 등의 로그인을 통해서 서비스를 이용할수 있게 한다.h
1. oautn 1.0  : 이전에는 서명의 값으로 안정성은 높지만 방식기 어렵고 복잡했다. 보안 강화를 서명방식으로 강화를 했다. 클라이언트와 서버간의 요청은 서명된 형태로 정송을 했었고 안전한 방식이었지만 구현이 복잡하고 힘든 단점

2. oauth 2.0 : 1.0의 복잡한 서명의 방식을 개선해섯 인정방식을 다르게 제공하게 되었다. 토큰의 인증을 사용해서 보안을 강화하고 서버는 엑세슷 토큰을발급해서 클라이언트는 받은 토큰을 가지고 권한을 증명할수 있게 되었다. 확장성이 늘어난것.
JWT 토큰을 생성하여 인증방식을 화장성있고 안전한 방식으로 제겅하게 되었다.

## 카카오 로그인 로직
> 카카오 로그인을 현제 2.0 프로토콜을 사용해서 인증을 처리하고 있고 사용자 인증을 API 을 제공하고있고 api 를 활용해서 카카오 계정을
로그인하고 동의를 받은루 인가코드를 전달받아서 코드를 가지고 정보를 요청해서 사용자 인증을 처리한다.

1. 사용자의 인증 : 유저가 어플리케이션엣서 카카오 로그인을 클릭하게 되면 리다이랙트로 카카오 서버의 로그인 화면으로 이동 카카오 서버에서 제공받은 로그인 화면에서 로그인을 하고 동의 화면까지 처리하게되면 AUTHORIZATION CODE 인가 코드를 받아서 백엔드에서 저\ㄴ달
콜백 URL 즉 리다이렉터 하는데 쿼리 스트링으로 인가코드를 전달
> 카카오 서버에 로그인 요청을 모낼떄에고 GET 방식으로 리다이렉터를 하는데. 쿼리 스트링으로 포함시켜서 요청을 보낸다
1-1 쿼리스트링으로 담아주는 내용은 
- 인증코드의 형태를 요청하는 구문 : RESPONSE_TYPE=CODE
- 클라이언트의 아이도 즉 우리가 만든 서비스 어플리케이션의 아이디값 고유의 값  : client_id 
- 리다이렉트 될 백엔드의 경로 로그인이후 요청보낼 백엔드 경로 즉 인가 코드가 있는 상태 : redirect_url
`- 동의에 필요한 권한의 목록 : scope=profile_nickname,scope=profile_image`

2. 인가 코드 : 유저가 로그인 하고 동의 화면에서 동의까지 하면 타타오에서 발급해주는 인증 코드를 우리 백엔드 경로로 리다이렉트 요청을 보내서 처리한다. 코드는 즉 인증을 받았다는 의미 유저가 동의한 내용의 api 를 사용해서 유저의 정보 또는 메시지 전송 등 친구목록의 api 를 호출할수 있다.

3. 엑세스 토큰 : 인가 코드따지 받고 나면 로그인 요청을 보낸뒤 엑세스 토큰 즉 카카오 로그인을 한 유저가 얼마나 인증 권한을 유지할띠
3-1 요청아ㅔ 핑요한 값
- grant_type=authorization_code
- code : 인가 코드 (authorization code)
- redirect_url : 재요청 보낼 백엔드의 주소
- client_id : 어플리케이션의 고유 아이디 값
- client_secret : 어플리케이션의 비미키 ( 카카오 디벨로퍼 개발자 사이트에서 제공받는다)
> 엑세스 토큰과 리프레ㄱ시 토큰이 생성된다.


4. api 유저 정보 요청
> 유저의 정보를 요청할수 있는 권한이 생기고 엑세스 토큰값을 가지고 인증 권한을 동의한 목록의 API 를 호출할수 있다. 요청보낼수 있다
> https://kapi.kakao.com/v2/user/me  이런  api 요청을 할때 엑세스 토큰을 헤더에 포함시켯 요청을 보내줘야한다.
> headers {Authorization : Bearer 엑세스 토큰 값}   Authorization 인증 토큰이라는 내용의 헤더의 값이고 Bearer 통상적으로 알려주는것
> Bearer 는 명칭을 정해놓은것 인증 토큰의 값이라고 알려주는것. 토큰 검증을 하고 API 의 응답을 해준다.

### 카카오 어플리케이션 생서 
<!--  가장 중요한 https://developers.kakao.com/console/app/1220327/product/login -->

1. 개발자 사아트 접속 https://developers.kakao.com/

2. 어플리케이션 텝에 어플리케이션 생성

3. 앱키의 사용할 키 목록을 확인해서 사용할 키의 값을 가져오고  clientid

4. 제품 설정에 카카오 로그인 탭 클릭

5. 로그인 활성화 설정 connect open id 활성화 설정 둘다 on

6. 리다이렉터 url 저장 : 로그인 후에 동의하면 이후에 인가 코드 받고 난뒤에 요청할 우리 백엔드 경로
> 예) http://localhost:3000/auth/kakao/callback


7. 제품 설정 탭에 동의 항목 설정 : api 요청을 보낼때 권한을 인증받은 서비스만 요청을 처라할수 있다

8. 제품 설정 탭의 비밀키 생성 코드 생성 : 토큰의 값을 더 안정하게 한호화 하기 위해서 사용되는 값 노출되면 안된다.

9. 제품 설정의 고급 탭에 logout ㄱㄷ약ㄷ찻 URI 추가 : 로그아웃 요청이후
> 예)  http://localhost:3000/auth/kakao/logout/callback




### 어플리케이션 설정 이후

